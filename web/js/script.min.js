$(document).ready(function(){function t(){$(".editable-title").editable({url:"/post",type:"text",title:"Modifier titre"}),$("#comments").editable({url:"/post",title:"Enter comments"}),$(".editable-url").editable({url:"/post",type:"text",title:"Modifier l'url",value:"",display:function(t,e){return!1},success:function(t,e){$(this).attr("href",e)}}),$(".editable-month").editable({url:"/post",type:"select",value:1,source:[{value:1,text:"JAN."},{value:2,text:"FEV."},{value:3,text:"MAR."},{value:4,text:"AVR."},{value:5,text:"MAI."},{value:6,text:"JUN."},{value:7,text:"JUL."},{value:8,text:"AOU."},{value:9,text:"SEP."},{value:10,text:"OCT."},{value:11,text:"NOV."},{value:12,text:"DEC."}]}),$(".editable-day").editable({url:"/post",format:"dd",viewformat:"dd",datepicker:{weekStart:1}}),$(".editable-week").editable({url:"/post",type:"select",value:1,source:[{value:1,text:"LUN."},{value:2,text:"MAR."},{value:3,text:"MER."},{value:4,text:"JEU."},{value:5,text:"VEN."},{value:6,text:"SAM."},{value:7,text:"DIM."}]}),$(".editable-hours").editable({url:"/post",format:"hh:ii",viewformat:"hh:ii",datetimepicker:{weekStart:1}})}function e(){var t=$(".sortable").find("li");t.each(function(t){$(this).attr("data-order",t+1)})}function i(t,e){var i=document.createElement("form");i.setAttribute("action",t),i.setAttribute("method","post"),i.setAttribute("target","_blanck");for(n in e){var a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name",n),a.setAttribute("value",e[n]),i.appendChild(a)}document.body.appendChild(i),i.submit()}var a="<button class='remove-button'>x</button>",l="<button class='edit-img__button'>Editer image</button>",o="<button class='edit-vid__button'>Editer video</button>",s="<button class='edit-btn__button'>Editer le bouton</button>",d='<div class="edit-popup"><h3 class="edit-popup__title">Modifier l\'image</h3><div class="edit-popup__content">Source:<input type="text" class="src" placeholder="Lien vers l\'image" value="">Description:<input type="text" class="alt" placeholder="Description de l\'image" value=""><button class="validate-btn btn-primary">Valider</button></div></div>',r='<div class="edit-popup"><h3 class="edit-popup__title">Modifier la vidéo</h3><div class="edit-popup__content">Source:<input type="text" class="src" placeholder="Lien vers l\'image" value="">Description:<input type="text" class="alt" placeholder="Description de l\'image" value="">Lien vers la vidéo:<input type="text" class="vidUrl" placeholder="Lien vers la vidéo" value=""><br><button class="validate-btn btn-primary">Valider</button></div></div>',c='<div class="edit-popup"><h3 class="edit-popup__title">Modifier le texte</h3><div class="edit-popup__content"><button type="button" class="btn btn-default btn-sm style-bold"><span class="glyphicon glyphicon-bold" aria-hidden="true"></span> Bold </button><button type="button" class="btn btn-default btn-sm style-italic"><span class="glyphicon glyphicon-italic" aria-hidden="true"></span> Italic </button><div class="edited-txt" contenteditable></div><button class="validate-btn the-text-btn btn-primary">Valider</button></div></div>',p='<div class="btn-edit-popup"><h3 class="edit-popup__title">Modifier le bouton</h3><div class="edit-popup__content">Lien:<input type="text" class="href" placeholder="Lien de redirection" value="">Texte:<input type="text" class="text" placeholder="Texte du bouton" value=""><button class="validate-btn btn-primary">Valider</button></div></div>';$(".block-draggable").draggable({cancel:".edit-popup",helper:"clone",distance:100}),$(".preview-zone__sortable").droppable({accept:".block-draggable",drop:function(e,i){console.log("Item was Dropped"),$(this).append($(i.draggable).clone().data("html")),t();var n=$(".preview-zone__sortable li").size();$(this).find("li").last().attr("data-order",n).prepend(a);var d=$(this).find("img.editable").last(),r=$(this).find("span.editable");d.hasClass("editable-src")&&($(this).find("img.editable").last().parent().before(l),console.log("Regular image is now editable...")),d.hasClass("editable-ce-src")&&($(this).find("img.editable-ce-src").last().before(l),console.log("Cartesia Education image is now editable...")),d.hasClass("editable-vid")&&($(this).find("img").last().parent().before(o),console.log("Has media...type:video")),r.hasClass("editable-btn")&&$(this).find("a").before(s)}}),$(".sortable").sortable({stop:e,cancel:".edit-popup,button,.popover",distance:100}).on("click",".remove-button",function(){$(this).parent().remove(),e()}).on("click",".edit-img__button",function(){$(this).parent().prepend(d);var t=$(this).closest("td").find("img"),e=$(this).parent().find(".src"),i=$(this).parent().find(".alt");e.attr("value",t.attr("src")),i.attr("value",t.attr("alt"))}).on("click",".edit-vid__button",function(){$(this).parent().prepend(r);var t=$(this).closest("td").find("img"),e=t.parent();console.log(e);var i=$(this).parent().find(".src"),a=$(this).parent().find(".alt"),l=$(this).parent().find(".vidUrl");i.attr("value",t.attr("src")),a.attr("value",t.attr("alt")),l.attr("value",e.attr("href"))}).on("click",".editable-text",function(){console.log(this),$(this).parent().prepend(c),$(this).addClass("current-editing");var t=$(this).html(),e=$(this).closest("td"),i=$(e).find(".edited-txt");$(i).html(t),$(".edited-txt").focus()}).on("click",".edit-btn__button",function(){$(this).closest("td").prepend(p)}).on("click",".style-bold",function(){document.execCommand("bold")}).on("click",".style-italic",function(){document.execCommand("italic")}).on("click",".edit-popup .the-text-btn",function(){var t=$(this).closest("td").find(".current-editing"),e=$(this).parent().find(".edited-txt");""!==e&&$(t).html($(e).html()),$(this).closest(".edit-popup").remove()}).on("click",".edit-popup .validate-btn",function(){var t=$(this).closest("td").find("img"),e=t.parent(),i=$(this).parent().find(".src").val(),a=$(this).parent().find(".alt").val(),l=$(this).parent().find(".vidUrl").val();""!==i&&t.attr("src",i),""!==a&&t.attr("alt",a),""!==l&&e.attr("href",l),$(this).closest(".edit-popup").remove()}),$(".preview-zone__sortable").on("click","a",function(t){t.preventDefault()}),$("#downloadLink").on("click",function(t){t.preventDefault();var e=$("#content-to-download");if(""==e.html())return alert("Champs de prévisualisation vide !"),!1;var l=e.find("li"),n="",o=$("#title").val();$("[data-original-title]").removeAttr("data-original-title");var s=$(l).find("button");s.detach(),$(l).each(function(){var t=$(this).html();n+=t}),$(".preview-zone__sortable li").prepend(a),i($(this).attr("data-blocks"),{title:o,blocks:n})}),$(document).mouseup(function(t){var e=$(".edit-popup");e.is(t.target)||0!==e.has(t.target).length||e.remove()})});